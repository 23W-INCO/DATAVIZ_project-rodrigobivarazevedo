<DOCTYPE html>
<meta charset="utf-8">
<!-- Load d3.js -->
<script src="https://d3js.org/d3.v6.js"></script>

</head>
<body>

<!-- Create a div where the graph will take place -->
<div id="my_dataviz"></div>

<script>
    const data = {
        'Albumin (g/dL)': [3.8, 'yellow'],
        'Albumin (g/L)': [38.0, 'yellow'],
        'Alanine aminotransferase ALT (U/L)': [14.0, 'green'],
        'Aspartate aminotransferase AST (U/L)': [14.0, 'yellow'],
        'Alkaline phosphatase (U/L)': [78.0, 'green'],
        'Blood urea nitrogen (mg/dL)': [32.0, 'red'],
        'Blood urea nitrogen (mmol/L)': [11.42, 'red'],
        'Total calcium (mg/dL)': [9.1, 'green'],
        'Total calcium (mmol/L)': [2.275, 'green'],
        'Creatine Phosphokinase (CPK) (IU/L)': [47.0, 'yellow'],
        'Cholesterol (mg/dL)': [86.0, 'red'],
        'Cholesterol (mmol/L)': [2.224, 'red'],
        'Bicarbonate (mmol/L)': [26.0, 'green'],
        'Creatinine (mg/dL)': [1.46, 'red'],
        'Creatinine (umol/L)': [129.06, 'red'],
        'Gamma glutamyl transferase (U/L)': [9.0, 'yellow'],
        'Glucose, serum (mg/dL)': [210.0, 'red'],
        'Glucose, serum (mmol/L)': [11.66, 'red'],
        'Iron, refrigerated (ug/dL)': [43.0, 'yellow'],
        'Iron, refrigerated (umol/L)': [7.7, 'yellow'],
        'Lactate Dehydrogenase (U/L)': [135.0, 'red'],
        'Phosphorus (mg/dL)': [4.9, 'yellow'],
        'Phosphorus (mmol/L)': [1.582, 'red'],
        'Total bilirubin (mg/dL)': [0.7, 'green'],
        'Total bilirubin (umol/L)': [11.97, 'green'],
        'Total protein (g/dL)': [7.2, 'green'],
        'Total protein (g/L)': [72.0, 'green'],
        'Uric acid (mg/dL)': [7.0, 'yellow'],
        'Uric acid (umol/L)': [416.4, 'yellow'],
        'Sodium (mmol/L)': [138.0, 'green'],
        'Potassium (mmol/L)': [4.3, 'green'],
        'Chloride (mmol/L)': [104.0, 'yellow'],
        'Osmolality (mmol/Kg)': [289.0, 'green'],
        'Globulin (g/dL)': [3.4, 'yellow'],
        'Globulin (g/L)': [34.0, 'yellow'],
        'Triglycerides (mg/dL)': [122.0, 'green'],
        'Triglycerides (mmol/L)': [1.377, 'green']
    };

         
    // Convert data to suitable format
    const dataArray = [];
    for (const key in data) {
        const [value, color] = data[key];
        dataArray.push({ value, color, key });
    }

    // Define margin and cell size
    const margin = { top: 20, right: 250, bottom: 20, left: 275 };
    const cellSize = 30;
    const cellWidth = 200; // Adjusted cell width for larger color blocks
    const cellHeight = 30; // Height of each cell

    // Create SVG element
    const svg = d3.select('#my_dataviz').append('svg')
        .attr('width', 800)
        .attr('height', dataArray.length * cellHeight + margin.top + margin.bottom)
        .style('margin', margin.top + 'px ' + margin.right + 'px ' + margin.bottom + 'px ' + margin.left + 'px');

    // Define color scale based on color strings
    const colorScale = d3.scaleOrdinal()
        .domain(['green', 'yellow', 'red'])
        .range(['green', '#ffd800', '#c80815']);

    // Draw cells
    svg.selectAll('rect')
        .data(dataArray)
        .enter().append('rect')
        .attr('x', margin.left)
        .attr('y', (d, i) => margin.top + i * cellHeight)
        .attr('width', cellWidth)
        .attr('height', cellHeight)
        .style('fill', d => colorScale(d.color))
        .on('mouseover', function (event, d) {
            // Display blood level on mouse hover
            d3.select(this).append('title').text(`Blood Level: ${d.value}`);
        });

    // Add y-axis labels with word wrapping
    svg.selectAll('text')
        .data(dataArray)
        .enter().append('text')
        .attr('x', margin.left - 10)
        .attr('y', (d, i) => margin.top + i * cellHeight + cellHeight / 2)
        .attr('dy', '0.35em')
        .style('text-anchor', 'end')
        .style('alignment-baseline', 'middle')
        .style('fill', 'black')
        .text(function (d) {
            // Split and wrap text to fit in the available space
            const words = d.key.split(/\s+/);
            let line = '';
            const lines = [];
            const lineHeight = 1.1; // ems

            for (const word of words) {
                const testLine = line.length === 0 ? word : `${line} ${word}`;
                const metrics = this.getComputedTextLength();
                if (metrics > margin.left - 10 && line.length > 0) {
                    lines.push(line);
                    line = word;
                } else {
                    line = testLine;
                }
            }

            lines.push(line);
            return lines.join('\n');
        });

    // Draw black lines between cells
    svg.selectAll('line')
        .data(dataArray)
        .enter().append('line')
        .attr('x1', margin.left)
        .attr('x2', margin.left + cellWidth)
        .attr('y1', (d, i) => margin.top + (i + 1) * cellHeight)
        .attr('y2', (d, i) => margin.top + (i + 1) * cellHeight)
        .style('stroke', 'black');

        

        
</script>

</body>
</html>

